<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ラテール　ダメージ計算機</title>

	<!-- Tailwind CSS CDN -->
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'bg': '#FFF5F7',
						'bg-secondary': '#FFE4E9',
						'bg-tertiary': '#FFDDE4',
						'border': '#FFB3BA',
						'border-light': '#FFCCDB',
						'text': '#3D2E40',
						'text-muted': '#6B5D6E',
						'text-dim': '#8B7D8E',
						'accent': '#E91E8C',
						'accent-hover': '#D61478',
						'danger': '#E6346D',
						'warning': '#E6A800',
						'success': '#2FA088',
						'input-bg': '#FFFFFF',
						'tab-active': '#FFE4E9',
						'tab-inactive': '#FFF5F7',
					},
					fontSize: {
						'2xs': '0.625rem',
					},
					spacing: {
						'18': '4.5rem',
					}
				}
			}
		}
	</script>
	<!-- コンパイル済みCSS -->
	<link rel="stylesheet" href="styles.css">
	<script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
	<script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
</head>

<body class="min-h-screen bg-bg text-text">
	<div class="container mx-auto max-w-5xl p-4">
		<!-- タイトル部分 -->
		<div class="title-container">
			<h1 class="title-text">
				ラテール　ダメージ計算機
			</h1>
		</div>
		<details class="details-container">
			<summary class="details-summary">説明</summary>
			<div class="details-content">
				<p>最終と％以外はステータス画面に表示された値を直接入れてください</p>
				<p>最終と％はダメージ計算には使用しません。上昇ダメージ計算に使用するため超越なんかで固定値を100増やしたり減らしたりして [変化するステ画面の数値 - 100] を入れてください</p>
				<p>＋１当たりダメ上昇はステ画面の +1 ではなく加算値を振った場合の価値です</p>
				<p>貫通は実際には整数値のみしか意味がありませんが少数値での価値を表示しています</p>
			</div>
		</details>

		<label class="dropzone">
			<input type="file" id="file-input" class="hidden">
			<span class="text-xs">📷 スクリーンショットから自動入力</span>
		</label>
		<p id="progress" class="text-center text-text-muted text-2xs mb-3"></p>
		<div id="app">
			<!-- ローディングオーバーレイ -->
			<div v-if="isCalculating" class="loading-overlay">
				<div class="loading-card">
					<div class="loading-content">
						<div class="loading-spinner"></div>
						<span class="loading-text">計算中...</span>
					</div>
				</div>
			</div>
			<!-- メインタブナビゲーション -->
			<div class="bg-bg-secondary border border-border rounded-t-lg overflow-hidden mb-0">
				<div class="flex border-b border-border">
					<button v-for="tab in [
						{ id: 'damage', label: 'ダメージ計算' },
						{ id: 'transcend1', label: '超越１' },
						{ id: 'transcend2', label: '超越２' },
						{ id: 'guild', label: 'ギルドスキル' },
						{ id: 'petPassive', label: 'ペットパッシブ' }
					]" :key="tab.id" @click="activeMainTab = tab.id" class="tab-button" :class="{
					'active': activeMainTab === tab.id
				}">
						{{ tab.label }}
					</button>
				</div>
			</div>
			<!-- メインタブコンテンツ -->
			<div class="bg-bg-secondary border border-t-0 border-border rounded-b-lg p-4 mb-4">
				<!-- ダメージ計算タブ -->
				<div v-if="activeMainTab === 'damage'">
					<!-- ダメージカード表示 -->
					<div class="grid-damage-cards-4">
						<div v-for="card in [
							{ id: 'base_damage', label: '青ダメ', value: formatDamage(results.baseDamage) },
							{ id: 'cri_damage', label: 'クリダメ', value: formatDamage(results.criDamage) },
							{ id: 'cri_rate', label: 'クリ率', value: (results.criRate).toFixed(1) + '%' },
							{ id: 'damage', label: '平均ダメ', value: formatDamage(results.damage) }
						]" :key="card.id" class="damage-card">
							<div class="card-label">{{ card.label }}</div>
							<div class="card-value">{{ card.value }}</div>
						</div>
					</div>
					<button id="copy" class="copy-button">
						コピーする
					</button>
					<!-- メインコンテンツエリア -->
					<div class="grid-main-content">
						<!-- 左側：スキル設定と敵設定 -->
						<div class="space-y-3">
							<!-- スキル設定 -->
							<div class="card-container border-accent/30">
								<div class="label-accent mb-2">スキル設定</div>
				<div class="setting-row">
					<label>職業</label>
					<select id="selectedJob" v-model="職業" @change="onJobChange" :class="{ 'unselected': !職業 }">
						<option value="" disabled>職業を選択</option>
						<option v-for="job in 職業リスト" :key="job" :value="job">{{ job }}</option>
					</select>
				</div>
				<div class="setting-row">
					<label>スキル</label>
					<select id="selectedSkill" v-model="スキル名" @change="onSkillChange" :title="selectedSkillTitle"
						:class="['skill-select', { 'unselected': !スキル名 }]">
						<option value="" disabled>スキルを選択</option>
						<option v-for="skill in 選択可能スキル" :key="skill.スキル名" :value="skill.スキル名">
							{{ skill.スキル名 }}
						</option>
					</select>
				</div>
								<div class="setting-row">
									<label>レベル</label>
									<div class="skill-multi-input">
										<input type="number" id="スキルレベル" min="1" :max="最大スキルレベル" v-model.lazy.number="スキルレベル"
											@change="onSkillLevelChange" @blur="triggerCalculation">
										<label>倍率</label>
										<input type="number" step="0.1" id="スキル倍率" v-model.lazy.number="inputs.スキル倍率"
											@blur="triggerCalculation" :readonly="currentSkillType === '攻撃' || currentSkillType === '召喚'"
											:class="{ 'disabled-state': currentSkillType === '攻撃' || currentSkillType === '召喚' }">
										<label>追加</label>
										<input type="number" id="スキル追加ダメ" v-model.lazy.number="inputs.スキル追加ダメ" @blur="triggerCalculation"
											:readonly="currentSkillType === '攻撃' || currentSkillType === '召喚'"
											:class="{ 'disabled-state': currentSkillType === '攻撃' || currentSkillType === '召喚' }">
									</div>
								</div>
								<div class="space-y-2">
									<!-- スキル属性選択 -->
									<div class="setting-row">
										<label>属性</label>
										<div class="flex-gap-4">
											<label v-for="type in ['物理', '魔法']" :key="type" class="radio-group">
												<input type="radio" name="physicalOrMagical" :value="type" v-model="inputs.攻撃タイプ">
												<span>{{ type }}</span>
											</label>
										</div>
									</div>
									<!-- スキルタイプ選択 -->
									<div class="setting-row">
										<label>タイプ</label>
										<div class="flex-gap-4">
											<label v-for="type in ['攻撃', '召喚']" :key="type" class="radio-group">
												<input type="radio" name="skillType" :value="type" v-model="inputs.スキルタイプ">
												<span>{{ type }}</span>
											</label>
										</div>
									</div>
					<!-- 召喚補正 (召喚タイプの場合のみ表示) -->
					<div v-if="currentSkillType === '召喚'" class="setting-row suffix">
						<label>召喚補正</label>
						<input type="number" id="召喚補正" v-model.lazy.number="inputs.ダメ補正" @blur="triggerCalculation">
						<span class="text-xs">%</span>
					</div>
								</div>
							</div>
							<!-- 敵設定 -->
							<div class="card-container border-danger/30">
								<div class="label-accent mb-2">敵設定</div>

				<!-- ダンジョン選択 -->
				<div class="setting-row enemy">
					<label>ダンジョン</label>
					<select id="selectedDungeon" v-model="ダンジョン" @change="onDungeonChange" :class="{ 'unselected': !ダンジョン }">
						<option value="" disabled>ダンジョンを選択</option>
						<option v-for="dungeon in ダンジョンリスト" :key="dungeon.level" :value="dungeon.name">
							{{ dungeon.name }}
						</option>
					</select>
				</div>

				<!-- 難易度選択（ダンジョン選択時のみ表示） -->
				<div class="setting-row enemy" v-if="ダンジョン">
					<label>難易度</label>
					<select id="selectedDifficulty" v-model="難易度" @change="onDifficultyChange" :class="{ 'unselected': !難易度 }">
						<option value="" disabled>難易度を選択</option>
						<option v-for="difficulty in 選択可能難易度" :key="difficulty" :value="difficulty">
							{{ difficulty }}
						</option>
					</select>
				</div>

				<!-- 敵選択（ダンジョン選択時のみ表示） -->
				<div class="setting-row enemy" v-if="ダンジョン">
					<label>敵</label>
					<select id="selectedEnemy" v-model="敵名" @change="onEnemyChange" :class="{ 'unselected': !敵名 }">
						<option value="" disabled>敵を選択</option>
						<option v-for="enemy in 選択可能敵" :key="enemy" :value="enemy">
							{{ enemy }}
						</option>
					</select>
				</div>

				<!-- 敵タイプ -->
				<div class="setting-row enemy">
					<label>タイプ</label>
					<select id="敵タイプ" v-model="inputs.敵タイプ">
						<option value="一般">一般</option>
						<option value="ボス">ボス</option>
					</select>
				</div>

				<!-- 敵ステータス入力 -->
				<div v-for="field in [
					{ id: '敵防御', label: '防御' },
					{ id: '敵ダメ減', label: 'ダメ減' },
					{ id: '敵ダメ減_乗算', label: 'ダメ減%' },
					{ id: '敵幸運', label: '幸運' },
					{ id: '敵クリ減', label: 'クリ減' }
				]" :key="field.id" class="setting-row enemy">
					<label>{{ field.label }}</label>
					<input type="number" :id="field.id" v-model.lazy.number="inputs[field.id]" @blur="triggerCalculation">
				</div>
							</div>
							<!-- HPダメージ換算設定 -->
							<div class="card-container border-accent/30">
								<div class="label-accent mb-2">その他設定</div>
								<div class="hp-value-setting">
									<label>HPダメージ換算</label>
									<input type="number" id="HPダメージ換算" v-model.lazy.number="inputs.HPダメージ換算" min="0" max="100"
										title="HP100%増加を火力何％換算するか" @blur="triggerCalculation">
									<span class="text-xs">%</span>
								</div>
							</div>
						</div>
						<!-- 右側：ステータス入力エリア -->
						<div class="card-container status-container">
							<!-- 共通ステータス -->

							<template v-for="stat in statKeys" :key="stat">

								<!-- 攻撃特殊レイアウト -->
								<template v-if="stat=='攻撃最小'"></template>
								<div v-else-if="stat=='攻撃最大'" class="attack-stats-grid">
									<!-- 攻撃_最大 -->
									<div class="input-group">
										<label>攻撃最大</label>
										<input type="number" id="攻撃最大" v-model.lazy.number="inputs.stats['攻撃最大']"
											@blur="triggerCalculation">
										<label>+</label>
										<span>{{ Math.floor(base('攻撃最大')) }}</span>
										<span>(+{{ incr('攻撃最大') }})</span>
									</div>
									<!-- 攻撃_最小 -->
									<div class="input-group">
										<label>攻撃最小</label>
										<input type="number" id="攻撃最小" v-model.lazy.number="inputs.stats['攻撃最小']"
											@blur="triggerCalculation">
										<label>+</label>
										<span>{{ Math.floor(base('攻撃最小')) }}</span>
										<span>(+{{ incr('攻撃最小') }})</span>
									</div>
									<!-- 攻撃_乗算 -->
									<label>%</label>
									<input type="number" id="攻撃_乗算" v-model.lazy.number="inputs.stats['攻撃_乗算']"
										@blur="triggerCalculation">
									<span>(+{{ incr('攻撃_乗算') }})</span>
								</div>

								<div class="input-group" v-else>
									<label>{{ label(stat) }}</label>
									<input type="number" :id="stat" v-model.lazy.number="inputs.stats[stat]" @blur="triggerCalculation">
									<template v-if="hasMultiplier(stat)">
										<label>+</label>
										<span>{{ Math.floor(base(stat)) }}</span>
										<span>(+{{ incr(stat) }})</span>
										<label>{{ label(mulKey(stat)) }}</label>
										<input type="number" :id="mulKey(stat)" v-model.lazy.number="inputs.stats[mulKey(stat)]"
											@blur="triggerCalculation">
										<span>(+{{ incr(mulKey(stat)) }})</span>
									</template>
									<template v-else>
										<span>(+{{ incr(stat) }})</span>
									</template>
								</div>
							</template>
						</div>
					</div>
				</div>

				<!-- 超越１タブ -->
				<div v-if="activeMainTab === 'transcend1'">
					<h3 class="section-header purple">超越1 優先度ランキング</h3>
					<div class="table-wrapper">
						<table class="w-full text-xs data-table transcend1-table">
							<thead>
								<tr class="table-header-row">
									<th>順位</th>
									<th>カテゴリ</th>
									<th>スキル名</th>
									<th>Lv</th>
									<th>コスト</th>
									<th>ダメ換算/P</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="(skill, index) in transcend1Rankings" :key="skill.id">
									<td>{{ index + 1 }}</td>
									<td>{{ ['根性','貪欲','闘志'][skill.position - 1] }}</td>
									<td v-html="skill.effects"></td>
									<td class="center">{{ skill.level || '' }}</td>
									<td class="right">{{ skill.cost }}</td>
									<td class="text-emphasized-cost">{{ skill.costPerPoint }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- 超越２タブ -->
				<div v-if="activeMainTab === 'transcend2'">
					<h3 class="section-header pink">超越2 優先度ランキング</h3>
					<div class="grid-transcend2-columns">
						<!-- v-forループで3列を生成 -->
						<div v-for="(tableTitle, columnIndex) in ['根性','貪欲','闘志']" :key="'col' + columnIndex">
							<h4 class="text-sm font-bold text-pink-500 mb-2">
								{{ tableTitle }}
							</h4>
							<div class="table-wrapper">
								<table class="w-full text-xs data-table compact transcend2-table">
									<thead>
										<tr class="table-header-row">
											<th>順位</th>
											<th>スキル名</th>
											<th>Lv</th>
											<th>消費P</th>
											<th>ダメ換算/P</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="(skill, index) in transcend2Rankings[columnIndex]" :key="skill.id + '_' + skill.level"
											:class="[
						'align-middle',
						columnIndex === 1 ? 'h-12' : ''
					]">
											<td>{{ index + 1 }}</td>
											<td v-html="skill.effects"></td>
											<td class="center">{{ skill.level || '' }}</td>
											<td class="right">{{ skill.cost }}</td>
											<td class="text-emphasized-cost">{{ skill.costPerPoint }}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>

				</div>

				<!-- ペットパッシブタブ -->
				<div v-if="activeMainTab === 'petPassive'">
					<h3 class="section-header accent">ペットパッシブ 優先度ランキング</h3>


					<div class="table-wrapper">
						<table class="w-full text-xs data-table pet-passive-table">
							<thead>
								<tr class="table-header-row">
									<th>順位</th>
									<th>ペット名</th>
									<th>スキルタイプ</th>
									<th>ステータス</th>
									<th>ダメ換算</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="(passive, index) in filteredPetPassiveRankings.slice(0, 1000)" :key="passive.id">
									<td>{{ index + 1 }}</td>
									<td>{{ passive.name }}</td>
									<td>{{ passive.skillType }}</td>
									<td>{{ passive.effect }}</td>
									<td class="text-emphasized-damage">{{ passive.damage }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- ギルドスキルタブ -->
				<div v-if="activeMainTab === 'guild'">
					<h3 class="section-header orange">ギルドスキル 優先度ランキング</h3>

					<!-- ギルドスキルグレードフィルタ -->
					<div class="filter-group">
						<label v-for="grade in guildSkillGradeOptions" :key="grade" class="filter-checkbox">
							<input type="checkbox" v-model="guildSkillGradeFilters[grade]" :disabled="isLastCheckedGuildGrade(grade)">
							<span>{{ grade }}</span>
						</label>
					</div>

					<div class="table-wrapper">
						<table class="w-full text-xs data-table guild-table">
							<thead>
								<tr class="table-header-row">
									<th>順位</th>
									<th>スキル名</th>
									<th>ステータス</th>
									<th>Lv</th>
									<th>コスト</th>
									<th>ダメ換算/P</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="(skill, index) in filteredGuildSkillRankings.slice(0, 1000)" :key="skill.key">
									<td>{{ index + 1 }}</td>
									<td>{{ skill.name }}</td>
									<td>{{ skill.effect }}</td>
									<td class="right">{{ skill.level }}</td>
									<td class="right">{{ skill.cost }}</td>
									<td class="text-emphasized-cost">{{ skill.costPerPoint.toFixed(4) }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="bundle.min.js"></script>
</body>

</html>
